import{j as a,al as ee,ah as Se,am as je,L as Ce,h as Ee}from"./ui-DKLpM7gz.js";import{e as Oe,R as c,r as I}from"./vendor-0XlEdgNv.js";import{C as Ne,a as Pe,B as D,b as ke,c as Re,l as we,L as _,I as B}from"./index-DFPI_ObD.js";var te={exports:{}},Ae="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Te=Ae,Ie=Te;function ne(){}function re(){}re.resetWarningCache=ne;var _e=function(){function n(r,s,o,m,l,i){if(i!==Ie){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:re,resetWarningCache:ne};return t.PropTypes=t,t};te.exports=_e();var Le=te.exports;const u=Oe(Le);function H(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function V(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?H(Object(t),!0).forEach(function(r){ae(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):H(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function L(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?L=function(e){return typeof e}:L=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(n)}function ae(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Ue(n,e){if(n==null)return{};var t={},r=Object.keys(n),s,o;for(o=0;o<r.length;o++)s=r[o],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function We(n,e){if(n==null)return{};var t=Ue(n,e),r,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(s=0;s<o.length;s++)r=o[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function oe(n,e){return Me(n)||Fe(n,e)||Be(n,e)||De()}function Me(n){if(Array.isArray(n))return n}function Fe(n,e){var t=n&&(typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"]);if(t!=null){var r=[],s=!0,o=!1,m,l;try{for(t=t.call(n);!(s=(m=t.next()).done)&&(r.push(m.value),!(e&&r.length===e));s=!0);}catch(i){o=!0,l=i}finally{try{!s&&t.return!=null&&t.return()}finally{if(o)throw l}}return r}}function Be(n,e){if(n){if(typeof n=="string")return G(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return G(n,e)}}function G(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function De(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var b=function(e,t,r){var s=!!r,o=c.useRef(r);c.useEffect(function(){o.current=r},[r]),c.useEffect(function(){if(!s||!e)return function(){};var m=function(){o.current&&o.current.apply(o,arguments)};return e.on(t,m),function(){e.off(t,m)}},[s,t,e,o])},q=function(e){var t=c.useRef(e);return c.useEffect(function(){t.current=e},[e]),t.current},k=function(e){return e!==null&&L(e)==="object"},qe=function(e){return k(e)&&typeof e.then=="function"},$e=function(e){return k(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},Q="[object Object]",Ye=function n(e,t){if(!k(e)||!k(t))return e===t;var r=Array.isArray(e),s=Array.isArray(t);if(r!==s)return!1;var o=Object.prototype.toString.call(e)===Q,m=Object.prototype.toString.call(t)===Q;if(o!==m)return!1;if(!o&&!r)return e===t;var l=Object.keys(e),i=Object.keys(t);if(l.length!==i.length)return!1;for(var g={},S=0;S<l.length;S+=1)g[l[S]]=!0;for(var j=0;j<i.length;j+=1)g[i[j]]=!0;var p=Object.keys(g);if(p.length!==l.length)return!1;var N=e,C=t,h=function(P){return n(N[P],C[P])};return p.every(h)},se=function(e,t,r){return k(e)?Object.keys(e).reduce(function(s,o){var m=!k(t)||!Ye(e[o],t[o]);return r.includes(o)?(m&&console.warn("Unsupported prop change: options.".concat(o," is not a mutable property.")),s):m?V(V({},s||{}),{},ae({},o,e[o])):s},null):null},ie="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",X=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ie;if(e===null||$e(e))return e;throw new Error(t)},Je=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ie;if(qe(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(s){return X(s,t)})};var r=X(e,t);return r===null?{tag:"empty"}:{tag:"sync",stripe:r}},ze=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"4.0.1"}),e.registerAppInfo({name:"react-stripe-js",version:"4.0.1",url:"https://stripe.com/docs/stripe-js/react"}))},U=c.createContext(null);U.displayName="ElementsContext";var ce=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},ue=function(e){var t=e.stripe,r=e.options,s=e.children,o=c.useMemo(function(){return Je(t)},[t]),m=c.useState(function(){return{stripe:o.tag==="sync"?o.stripe:null,elements:o.tag==="sync"?o.stripe.elements(r):null}}),l=oe(m,2),i=l[0],g=l[1];c.useEffect(function(){var p=!0,N=function(h){g(function(x){return x.stripe?x:{stripe:h,elements:h.elements(r)}})};return o.tag==="async"&&!i.stripe?o.stripePromise.then(function(C){C&&p&&N(C)}):o.tag==="sync"&&!i.stripe&&N(o.stripe),function(){p=!1}},[o,i,r]);var S=q(t);c.useEffect(function(){S!==null&&S!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[S,t]);var j=q(r);return c.useEffect(function(){if(i.elements){var p=se(r,j,["clientSecret","fonts"]);p&&i.elements.update(p)}},[r,j,i.elements]),c.useEffect(function(){ze(i.stripe)},[i.stripe]),c.createElement(U.Provider,{value:i},s)};ue.propTypes={stripe:u.any,options:u.object};var Ke=function(e){var t=c.useContext(U);return ce(t,e)},He=function(){var e=Ke("calls useElements()"),t=e.elements;return t};u.func.isRequired;var le=c.createContext(null);le.displayName="CheckoutContext";u.any,u.shape({fetchClientSecret:u.func.isRequired,elementsOptions:u.object}).isRequired;var $=function(e){var t=c.useContext(le),r=c.useContext(U);if(t){if(r)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t}else return ce(r,e)},Ve=["mode"],Ge=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},d=function(e,t){var r="".concat(Ge(e),"Element"),s=function(i){var g=i.id,S=i.className,j=i.options,p=j===void 0?{}:j,N=i.onBlur,C=i.onFocus,h=i.onReady,x=i.onChange,P=i.onEscape,R=i.onClick,W=i.onLoadError,pe=i.onLoaderStart,me=i.onNetworksChange,de=i.onConfirm,fe=i.onCancel,he=i.onShippingAddressChange,ye=i.onShippingRateChange,ve=i.onSavedPaymentMethodRemove,ge=i.onSavedPaymentMethodUpdate,w=$("mounts <".concat(r,">")),A="elements"in w?w.elements:null,T="checkoutState"in w?w.checkoutState:null,E=(T==null?void 0:T.type)==="success"?T.checkout:null,xe=c.useState(null),Y=oe(xe,2),y=Y[0],be=Y[1],O=c.useRef(null),M=c.useRef(null);b(y,"blur",N),b(y,"focus",C),b(y,"escape",P),b(y,"click",R),b(y,"loaderror",W),b(y,"loaderstart",pe),b(y,"networkschange",me),b(y,"confirm",de),b(y,"cancel",fe),b(y,"shippingaddresschange",he),b(y,"shippingratechange",ye),b(y,"savedpaymentmethodremove",ve),b(y,"savedpaymentmethodupdate",ge),b(y,"change",x);var F;h&&(e==="expressCheckout"?F=h:F=function(){h(y)}),b(y,"ready",F),c.useLayoutEffect(function(){if(O.current===null&&M.current!==null&&(A||E)){var v=null;if(E)switch(e){case"payment":v=E.createPaymentElement(p);break;case"address":if("mode"in p){var z=p.mode,K=We(p,Ve);if(z==="shipping")v=E.createShippingAddressElement(K);else if(z==="billing")v=E.createBillingAddressElement(K);else throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.")}else throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");break;case"expressCheckout":v=E.createExpressCheckoutElement(p);break;case"currencySelector":v=E.createCurrencySelectorElement();break;case"taxId":v=E.createTaxIdElement(p);break;default:throw new Error("Invalid Element type ".concat(r,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else A&&(v=A.create(e,p));O.current=v,be(v),v&&v.mount(M.current)}},[A,E,p]);var J=q(p);return c.useEffect(function(){if(O.current){var v=se(p,J,["paymentRequest"]);v&&"update"in O.current&&O.current.update(v)}},[p,J]),c.useLayoutEffect(function(){return function(){if(O.current&&typeof O.current.destroy=="function")try{O.current.destroy(),O.current=null}catch{}}},[]),c.createElement("div",{id:g,className:S,ref:M})},o=function(i){$("mounts <".concat(r,">"));var g=i.id,S=i.className;return c.createElement("div",{id:g,className:S})},m=t?o:s;return m.propTypes={id:u.string,className:u.string,onChange:u.func,onBlur:u.func,onFocus:u.func,onReady:u.func,onEscape:u.func,onClick:u.func,onLoadError:u.func,onLoaderStart:u.func,onNetworksChange:u.func,onConfirm:u.func,onCancel:u.func,onShippingAddressChange:u.func,onShippingRateChange:u.func,onSavedPaymentMethodRemove:u.func,onSavedPaymentMethodUpdate:u.func,options:u.object},m.displayName=r,m.__elementType=e,m},f=typeof window>"u",Qe=c.createContext(null);Qe.displayName="EmbeddedCheckoutProviderContext";var Xe=function(){var e=$("calls useStripe()"),t=e.stripe;return t};d("auBankAccount",f);var Z=d("card",f);d("cardNumber",f);d("cardExpiry",f);d("cardCvc",f);d("fpxBank",f);d("iban",f);d("idealBank",f);d("p24Bank",f);d("epsBank",f);d("payment",f);d("expressCheckout",f);d("paymentRequestButton",f);d("linkAuthentication",f);d("address",f);d("shippingAddress",f);d("paymentMethodMessaging",f);d("affirmMessage",f);d("afterpayClearpayMessage",f);d("taxId",f);const Ze=we(void 0);function et({onBack:n,selectedClass:e,selectedPackage:t,onSuccess:r,user:s}){const o=Xe(),m=He(),[l,i]=I.useState({name:(s==null?void 0:s.name)||"",email:(s==null?void 0:s.email)||"",phone:""}),[g,S]=I.useState(!1),[j,p]=I.useState(null);I.useEffect(()=>{s&&i({name:s.name||"",email:s.email||"",phone:""})},[s]);const N=async h=>{if(h.preventDefault(),!(!o||!m)){S(!0),p(null);try{const x=await fetch("/.netlify/functions/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:t?t.price:11,currency:"usd",metadata:{studentName:l.name,studentEmail:l.email,studentPhone:l.phone,classDetails:JSON.stringify(e||{}),packageDetails:JSON.stringify(t||{})}})}),{clientSecret:P}=await x.json(),{error:R,paymentIntent:W}=await o.confirmCardPayment(P,{payment_method:{card:m.getElement(Z),billing_details:{name:l.name,email:l.email,phone:l.phone}}});R?p(R.message||"Payment failed"):W.status==="succeeded"&&r()}catch(x){p(x.message||"Payment failed")}finally{S(!1)}}},C=t?t.price:11;return t?t.name:e!=null&&e.name,a.jsxs("form",{onSubmit:N,className:"space-y-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(_,{htmlFor:"name",children:"Full Name"}),a.jsx(B,{id:"name",value:l.name,onChange:h=>i(x=>({...x,name:h.target.value})),required:!0})]}),a.jsxs("div",{children:[a.jsx(_,{htmlFor:"email",children:"Email"}),a.jsx(B,{id:"email",type:"email",value:l.email,onChange:h=>i(x=>({...x,email:h.target.value})),required:!0})]}),a.jsxs("div",{children:[a.jsx(_,{htmlFor:"phone",children:"Phone (Optional)"}),a.jsx(B,{id:"phone",value:l.phone,onChange:h=>i(x=>({...x,phone:h.target.value}))})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(_,{children:"Card Information"}),a.jsx("div",{className:"p-4 border rounded-lg",children:a.jsx(Z,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}}}}})})]}),j&&a.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700",children:j}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs(D,{type:"button",variant:"outline",onClick:n,className:"flex-1",children:[a.jsx(ee,{className:"w-4 h-4 mr-2"}),"Back"]}),a.jsx(D,{type:"submit",disabled:!o||g,className:"flex-1",children:g?a.jsxs(a.Fragment,{children:[a.jsx(Ce,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Pay $",C]})})]})]})}function at({onBack:n,selectedClass:e,selectedPackage:t,onSuccess:r,user:s}){const o=t?t.price:11,m=t?t.name:(e==null?void 0:e.name)||"Single Class";return a.jsx("div",{className:"min-h-screen bg-background",children:a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsx("div",{className:"max-w-2xl mx-auto",children:a.jsxs(Ne,{children:[a.jsx(Pe,{children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(D,{variant:"ghost",size:"sm",onClick:n,children:a.jsx(ee,{className:"w-4 h-4"})}),a.jsxs("div",{children:[a.jsxs(ke,{className:"flex items-center gap-2",children:[a.jsx(Se,{className:"w-5 h-5 text-green-600"}),"Secure Payment"]}),a.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Powered by Stripe - Your payment information is secure"})]})]})}),a.jsxs(Re,{className:"space-y-6",children:[a.jsx("div",{className:"bg-accent/30 p-4 rounded-lg",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:m}),a.jsx("p",{className:"text-sm text-muted-foreground",children:t?"Package":"Single Class"})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-2xl font-bold",children:["$",o]}),a.jsx("div",{className:"text-sm text-muted-foreground",children:"USD"})]})]})}),a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[a.jsx(je,{className:"w-4 h-4"}),a.jsx("span",{children:"Your payment information is encrypted and secure"})]}),a.jsx(ue,{stripe:Ze,children:a.jsx(et,{onBack:n,selectedClass:e,selectedPackage:t,onSuccess:r,user:s})})]})]})})})})}export{at as StripeElementsPayment};
