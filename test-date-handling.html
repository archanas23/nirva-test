<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date Handling Test - Nirva Yoga</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
        .success { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .warning { background: #fff3e0; border-left: 4px solid #ff9800; }
        button { padding: 10px 20px; margin: 5px; background: #2196f3; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #1976d2; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üß™ Date Handling Test - Nirva Yoga Studio</h1>
    <p>This test verifies that date handling works correctly and doesn't shift dates by one day.</p>

    <div class="test-section">
        <h2>Test 1: Date Input Parsing</h2>
        <input type="date" id="testDate" value="2025-09-25">
        <button onclick="testDateParsing()">Test Date Parsing</button>
        <div id="parsingResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Timezone Conversion Issues</h2>
        <button onclick="testTimezoneIssues()">Test Timezone Issues</button>
        <div id="timezoneResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Admin Session Manager Logic</h2>
        <button onclick="testAdminSessionLogic()">Test Admin Session Logic</button>
        <div id="adminResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Class Booking Logic</h2>
        <button onclick="testClassBookingLogic()">Test Class Booking Logic</button>
        <div id="bookingResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 5: Quick Add Week Logic</h2>
        <button onclick="testQuickAddWeek()">Test Quick Add Week</button>
        <div id="quickAddResult"></div>
    </div>

    <script>
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            container.appendChild(div);
        }

        function testDateParsing() {
            const testDate = document.getElementById('testDate').value;
            logResult('parsingResult', `Testing date: ${testDate}`, 'info');
            
            // Test 1: Direct parsing
            const directParse = new Date(testDate);
            logResult('parsingResult', `Direct parse: ${directParse.toDateString()} (${directParse.toISOString()})`, 'info');
            
            // Test 2: Local parsing (our fix)
            const [year, month, day] = testDate.split('-').map(Number);
            const localParse = new Date(year, month - 1, day);
            logResult('parsingResult', `Local parse: ${localParse.toDateString()} (${localParse.toISOString()})`, 'info');
            
            // Test 3: ISO string conversion
            const isoString = directParse.toISOString().split('T')[0];
            logResult('parsingResult', `ISO string: ${isoString}`, 'info');
            
            // Test 4: Local string conversion
            const localString = `${localParse.getFullYear()}-${String(localParse.getMonth() + 1).padStart(2, '0')}-${String(localParse.getDate()).padStart(2, '0')}`;
            logResult('parsingResult', `Local string: ${localString}`, 'info');
            
            // Check if they match
            if (testDate === localString) {
                logResult('parsingResult', '‚úÖ Local parsing preserves original date', 'success');
            } else {
                logResult('parsingResult', '‚ùå Local parsing changed the date', 'error');
            }
            
            if (testDate === isoString) {
                logResult('parsingResult', '‚úÖ ISO parsing preserves original date', 'success');
            } else {
                logResult('parsingResult', '‚ùå ISO parsing changed the date', 'warning');
            }
        }

        function testTimezoneIssues() {
            const testDates = ['2025-09-25', '2025-12-31', '2025-01-01'];
            
            testDates.forEach(dateStr => {
                logResult('timezoneResult', `Testing: ${dateStr}`, 'info');
                
                // Old method (problematic)
                const oldMethod = new Date(dateStr).toISOString().split('T')[0];
                
                // New method (our fix)
                const [year, month, day] = dateStr.split('-').map(Number);
                const newMethod = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                logResult('timezoneResult', `Old method: ${oldMethod}`, oldMethod === dateStr ? 'success' : 'error');
                logResult('timezoneResult', `New method: ${newMethod}`, newMethod === dateStr ? 'success' : 'error');
                
                if (oldMethod !== dateStr) {
                    logResult('timezoneResult', `‚ö†Ô∏è Old method shifted date by ${Math.abs(new Date(dateStr).getTimezoneOffset() / 60)} hours`, 'warning');
                }
            });
        }

        function testAdminSessionLogic() {
            const testDate = '2025-09-25';
            logResult('adminResult', `Testing admin session logic with date: ${testDate}`, 'info');
            
            // Simulate the convertDayToDate function from admin session manager
            function convertDayToDate(dateStr) {
                const [year, month, day] = dateStr.split('-').map(Number);
                const date = new Date(year, month - 1, day);
                const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                                   'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const monthName = monthNames[date.getMonth()];
                const dayNum = date.getDate();
                return `${monthName} ${dayNum}`;
            }
            
            const result = convertDayToDate(testDate);
            logResult('adminResult', `Input: ${testDate}`, 'info');
            logResult('adminResult', `Output: ${result}`, 'info');
            logResult('adminResult', `Expected: Sep 25`, 'info');
            
            if (result === 'Sep 25') {
                logResult('adminResult', '‚úÖ Admin session logic works correctly', 'success');
            } else {
                logResult('adminResult', '‚ùå Admin session logic failed', 'error');
            }
        }

        function testClassBookingLogic() {
            const testDate = '2025-09-25';
            logResult('bookingResult', `Testing class booking logic with date: ${testDate}`, 'info');
            
            // Simulate the convertDayToDate function from App.tsx
            function convertDayToDate(dayStr) {
                if (/^\d{4}-\d{2}-\d{2}$/.test(dayStr)) {
                    return dayStr;
                }
                
                const date = new Date(dayStr);
                if (!isNaN(date.getTime())) {
                    return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                }
                
                return '2025-09-01';
            }
            
            const result = convertDayToDate(testDate);
            logResult('bookingResult', `Input: ${testDate}`, 'info');
            logResult('bookingResult', `Output: ${result}`, 'info');
            
            if (result === testDate) {
                logResult('bookingResult', '‚úÖ Class booking logic works correctly', 'success');
            } else {
                logResult('bookingResult', '‚ùå Class booking logic failed', 'error');
            }
        }

        function testQuickAddWeek() {
            const startDate = '2025-09-23'; // Monday
            logResult('quickAddResult', `Testing quick add week starting: ${startDate}`, 'info');
            
            const start = new Date(startDate);
            const sessions = [];
            
            for (let dayOffset = 0; dayOffset < 7; dayOffset++) {
                const currentDate = new Date(start);
                currentDate.setDate(start.getDate() + dayOffset);
                
                // Old method (problematic)
                const oldMethod = currentDate.toISOString().split('T')[0];
                
                // New method (our fix)
                const newMethod = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
                
                sessions.push({
                    dayOffset,
                    dateString: currentDate.toDateString(),
                    oldMethod,
                    newMethod
                });
            }
            
            sessions.forEach(session => {
                logResult('quickAddResult', `Day ${session.dayOffset}: ${session.dateString}`, 'info');
                logResult('quickAddResult', `  Old method: ${session.oldMethod}`, session.oldMethod === session.newMethod ? 'success' : 'warning');
                logResult('quickAddResult', `  New method: ${session.newMethod}`, 'success');
            });
        }

        // Run all tests on page load
        window.onload = function() {
            logResult('parsingResult', 'Page loaded. Click test buttons to run individual tests.', 'info');
        };
    </script>
</body>
</html>
